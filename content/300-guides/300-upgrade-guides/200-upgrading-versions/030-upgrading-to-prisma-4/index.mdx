---
title: 'Upgrade to Prisma 4'
metaTitle: 'Upgrade to Prisma 4'
metaDescription: 'Guides on how to upgrade to Prisma 4'
tocDepth: 2
toc: true
---

<TopBlock>

Prisma 4 introduces a number of **breaking changes** if you are upgrading from an earlier version (`3.x.x`). This guide explains how this upgrade might affect your application and gives instructions on how to handle any changes.

</TopBlock>

## Breaking changes

### Index configuration

In Prisma 4, the `extendedIndexes` Preview feature will now become generally available. This includes the following index configuration options:

- Length configuration of indexes, unique constraints and primary key constraints for MySQL (in Preview in versions `3.5.0` and later)
- Sort order configuration of indexes, unique constraints and primary key constraints (in Preview in versions `3.5.0` and later)
- New index types for PostgreSQL: Hash (in Preview in versions `3.6.0` and later) and GIN, GiST, SP-GiST and BRIN (in Preview in versions `3.14.0` and later)
- Index clustering for SQL Server (in Preview in versions `3.13.0` and later)

#### Length configuration (MySQL)

#### Sort order configuration

#### Hash indexes (PostgreSQL)

#### GIN, GiST, SP-Gist

### Scalar list defaults

For database connectors that support scalar lists (PostgreSQL, CockroachDB and MongoDB), Prisma 4 introduces the ability to set a default value in your Prisma schema file using the `@default` attribute:

<TabbedContent tabs={[<FileWithIcon text="Relational databases" icon="database"/>, <FileWithIcon text="MongoDB" icon="database"/>]}>
<tab>

```prisma highlight=3;normal
model User {
  id             Int      @id @default(autoincrement())
  posts          Post[]
  favoriteColors String[] @default(["red", "yellow", "purple"])
}
```

</tab>
<tab>

```prisma highlight=3;normal
model User {
  id             String   @id @default(auto()) @map("_id") @db.ObjectId
  posts          Post[]
  favoriteColors String[] @default(["red", "yellow", "purple"])
}
```

</tab>
</TabbedContent>

This is a breaking change if you previously had defaults defined for scalar lists at the database level.

### Explicit `@unique` constraints on one-to-one relations

When using one-to-one relations in Prisma 4, you will need to explicitly add the `@unique` attribute on the relation scalar field. For example, for this one-to-one relation between a `User` and a `Profile` model, you will need to add the `@unique` attribute to the `profileId` field:

<TabbedContent tabs={[<FileWithIcon text="Relational databases" icon="database"/>, <FileWithIcon text="MongoDB" icon="database"/>]}>
<tab>

```prisma
model User {
  id        Int      @id @default(autoincrement())
  profile   Profile? @relation(fields: [profileId], references: [id])
  profileId Int?     @unique // <-- include this explicitly
}

model Profile {
  id   Int   @id @default(autoincrement())
  user User?
}
```

</tab>
<tab>

```prisma
model User {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  profile   Profile? @relation(fields: [profileId], references: [id])
  profileId String?  @unique @db.ObjectId // <-- include this explicitly
}

model Profile {
  id   String @id @default(auto()) @map("_id") @db.ObjectId
  user User?
}
```

</tab>
</TabbedContent>

### Removing `references` syntax for implicit many-to-many relations

When using [implicit many-to-many relations](/concepts/components/prisma-schema/relations/many-to-many-relations#implicit-many-to-many-relations) in Prisma 4, you will no longer be able to use the `references` argument, which was previously optional. For example, the following relation would now trigger a validation error:

```prisma file=schema.prisma
model Post {
  id         Int        @id @default(autoincrement())
  categories Category[] @relation("my-relation", references: [id]) // <-- validation error
}

model Category {
  id    Int    @id @default(autoincrement())
  posts Post[] @relation("my-relation", references: [id]) // <-- validation error
}
```

Instead, you can write:

```prisma file=schema.prisma
model Post {
  id         Int        @id @default(autoincrement())
  categories Category[] @relation("my-relation")
}

model Category {
  id    Int    @id @default(autoincrement())
  posts Post[] @relation("my-relation")
}
```

This is because the only valid value for `references` was `id`, so removing this argument makes it clearer what can and cannot be changed.

## Specific upgrade paths

<Subsections />

## Upgrading the <inlinecode>prisma</inlinecode> and <inlinecode>@prisma/client</inlinecode> packages to Prisma 4

To upgrade to Prisma 4 from a `3.x.x` version, you need to update both the `prisma` and `@prisma/client` packages. Both the `prisma` and `@prisma/client` packages install with a caret `^` in their version number. This allows upgrades to new minor versions, but not major versions, to safeguard against breaking changes.

To ignore the caret `^` and upgrade across major versions, you can use the `@4` tag when upgrading with `npm`, or `yarn`:

<Admonition type="alert">

Before upgrading, check each **breaking change** to see how the upgrade might affect your application.

</Admonition>

<TabbedContent tabs={[<FileWithIcon text="npm" icon="file"/>, <FileWithIcon text="yarn" icon="file"/>]}>

<tab>

```terminal
npm install prisma@4 @prisma/client@4
```

</tab>

<tab>

```terminal
yarn upgrade prisma@4 @prisma/client@4
```

</tab>

</TabbedContent>
